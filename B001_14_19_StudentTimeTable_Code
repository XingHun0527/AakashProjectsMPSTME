//AddSubjects.java
package org.mazzarellialessio.studenttimetable;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import android.app.Activity;
import android.app.AlertDialog;
import android.app.Dialog;
import android.content.Context;
import android.content.DialogInterface;
import android.graphics.Color;
import android.os.Bundle;
import android.view.ContextMenu;
import android.view.ContextMenu.ContextMenuInfo;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.Window;
import android.view.View.OnClickListener;
import android.widget.AdapterView.AdapterContextMenuInfo;
import android.widget.Button;
import android.widget.ListView;
import android.widget.SimpleAdapter;
import android.widget.TextView;

public class AddSubjects extends Activity {
	
	private static ListView lv;
	private static String[] from = {"SName","STeacher"};
    private static int[] to = {R.id.SNameL,R.id.STeacherL};
	private static MyDBManager dm;
    private static ArrayList<HashMap<String, Object>> results;
    private static Dialog addDialog;
    private static Button addBT;
    private static Button cancelBT;
    private static Button colorBT;
    private static TextView SName;
	private static TextView STeacher;
	private static Context context;
	private static String currentColor;
	private static String colorVet[];
	private static String action = "insert";
	private static String SNameS;
    private static AlertDialog.Builder builder;
    private static AlertDialog alert;

    @Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
	    setContentView(R.layout.addsubjects);
	    
	    lv = (ListView) findViewById(R.id.Slist);
	    dm = new MyDBManager(this);
	    update();
	    addDialog = new Dialog(this);
	    addDialog.setCancelable(false);
	    addDialog.requestWindowFeature(Window.FEATURE_NO_TITLE);
	    addDialog.setContentView(R.layout.adddialog);
	    SName = (TextView)addDialog.findViewById(R.id.SName);
	    STeacher = (TextView)addDialog.findViewById(R.id.STeacher);
	    colorBT = (Button) addDialog.findViewById(R.id.colorBT);
	    context = this;
	    currentColor = "#0000ff";
	    colorBT.setOnClickListener(new OnClickListener() {
	    	
			public void onClick(View v) {
				
				ColorPickerDialog cpd = new ColorPickerDialog(context,
						new ColorPickerDialog.OnColorChangedListener() {
					
					public void colorChanged(int color) {
						currentColor = Integer.toHexString(color);
						currentColor = currentColor.substring(2, 8);
						currentColor = "#"+currentColor;
						colorBT.setBackgroundColor(color);
					}
				}, Color.parseColor(currentColor));
				cpd.show();
			}
	    	
	    });
	    cancelBT = (Button) addDialog.findViewById(R.id.cancelBT);
	    cancelBT.setOnClickListener(new OnClickListener() {
	    	
			public void onClick(View v) {
				addDialog.cancel();
				SName.setText(null);
				STeacher.setText(null);
			}
	    	
	    });
	    addBT = (Button) addDialog.findViewById(R.id.addBT);
	    addBT.setOnClickListener(new OnClickListener() {
	    			
			public void onClick(View v) {
				if(action == "insert") {
					dm.insertIntoSubjects(SName.getText().toString(), STeacher.getText().toString(), currentColor);
				}else if(action == "update"){
	        		dm.updateSubjects(SName.getText().toString(), STeacher.getText().toString(), currentColor);
				}
				update();
				addDialog.cancel();
				SName.setText(null);
				STeacher.setText(null);
			}
	    	
	    });
	    
	    registerForContextMenu(lv);
	    
    	builder = new AlertDialog.Builder(this);
        builder.setMessage("Are you sure you want to delete this subject? (All lessons contains this " +
        		"subject will be deleted)")
               .setCancelable(false)
               .setPositiveButton("Yes", new DialogInterface.OnClickListener() {
                   public void onClick(DialogInterface dialog, int id) {
                	   dm.deleteSubjects(SNameS);
                       update();
                   }
               })
               .setNegativeButton("No", new DialogInterface.OnClickListener() {
                   public void onClick(DialogInterface dialog, int id) {
                        dialog.cancel();
                   }
               });
        alert = builder.create();
	}
    
    public void onCreateContextMenu(ContextMenu menu, View v, ContextMenuInfo menuInfo) {
    	super.onCreateContextMenu(menu, v, menuInfo);
    	menu.add(0, 1, 0, "Edit");
    	menu.add(0, 2, 0, "Delete");
    	menu.setHeaderTitle("Options");	
    }
    
    public boolean onContextItemSelected(MenuItem item) {
    	
    	AdapterContextMenuInfo info = (AdapterContextMenuInfo) item.getMenuInfo();
    	SNameS = results.get(info.position).get("SName").toString();
    	String STeacherS = results.get(info.position).get("STeacher").toString();
    	currentColor = results.get(info.position).get("SColor").toString();
    	
    	switch (item.getItemId()) {
        	case 1:
        		addDialog.show();
				SName.setText(SNameS);
				STeacher.setText(STeacherS);
				colorBT.setBackgroundColor(Color.parseColor(currentColor));
				action = "update";
				SName.setEnabled(false);
        		SName.setText(SNameS);
				STeacher.setText(STeacherS);
        		break;
        	case 2:
        		alert.show();
        		break;
    	}
    	update();
    	return true;
    }
	
	public void addSubject(View v) {
		SName.setEnabled(true);
		addDialog.show();
		action = "insert";
		SName.requestFocus();
	}
	
	public class myAdapter extends SimpleAdapter{
        
		String[] colors;
        public myAdapter(Context context, List<? extends Map<String, ?>> data,
        	int resource, String[] from, int[] to, String[] col) {
            	super(context, data, resource, from, to);
                colors = col;
        	}
            public View getView(int position, View convertView, ViewGroup parent ) {
            	View view = super.getView(position, convertView, parent);
            	View label = view.findViewById(R.id.colorLabel);
                label.setBackgroundColor(Color.parseColor(colors[position]));
                return view;
            }
    }
	
	private void update() {
		results = dm.selectSubjects();
		colorVet = new String[results.size()];
	    for(int i=0;i<results.size();i++) {
	    	HashMap<String, Object> color = 
	    		new HashMap<String, Object>();
	    	color = results.get(i);
	    	colorVet[i] = (String) color.get("SColor");
	    }
	    myAdapter mA = new myAdapter(this, results, R.layout.subjectlist, from, to, colorVet);
		lv.setAdapter(mA);
	}
	
	public void onBackPressed () {
		finish();
	}

}

//ColorPickerDialog.java
/*
 * Copyright (C) 2007 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.mazzarellialessio.studenttimetable;

import android.os.Bundle;
import android.app.Dialog;
import android.content.Context;
import android.graphics.*;
import android.view.MotionEvent;
import android.view.View;

public class ColorPickerDialog extends Dialog {

    public interface OnColorChangedListener {
        void colorChanged(int color);
    }

    private OnColorChangedListener mListener;
    private int mInitialColor;

    private static class ColorPickerView extends View {
        private Paint mPaint;
        private Paint mCenterPaint;
        private final int[] mColors;
        private OnColorChangedListener mListener;

        ColorPickerView(Context c, OnColorChangedListener l, int color) {
            super(c);
            mListener = l;
            mColors = new int[] {
                0xFFFF0000, 0xFFFF00FF, 0xFF0000FF, 0xFF00FFFF, 0xFF00FF00,
                0xFFFFFF00, 0xFFFF0000
            };
            Shader s = new SweepGradient(0, 0, mColors, null);

            mPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
            mPaint.setShader(s);
            mPaint.setStyle(Paint.Style.STROKE);
            mPaint.setStrokeWidth(32);

            mCenterPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
            mCenterPaint.setColor(color);
            mCenterPaint.setStrokeWidth(5);
        }

        private boolean mTrackingCenter;
        private boolean mHighlightCenter;

        @Override 
        protected void onDraw(Canvas canvas) {
            float r = CENTER_X - mPaint.getStrokeWidth()*0.5f;

            canvas.translate(CENTER_X, CENTER_X);

            canvas.drawOval(new RectF(-r, -r, r, r), mPaint);            
            canvas.drawCircle(0, 0, CENTER_RADIUS, mCenterPaint);

            if (mTrackingCenter) {
                int c = mCenterPaint.getColor();
                mCenterPaint.setStyle(Paint.Style.STROKE);

                if (mHighlightCenter) {
                    mCenterPaint.setAlpha(0xFF);
                } else {
                    mCenterPaint.setAlpha(0x80);
                }
                canvas.drawCircle(0, 0,
                                  CENTER_RADIUS + mCenterPaint.getStrokeWidth(),
                                  mCenterPaint);

                mCenterPaint.setStyle(Paint.Style.FILL);
                mCenterPaint.setColor(c);
            }
        }

        @Override
        protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
            setMeasuredDimension(CENTER_X*2, CENTER_Y*2);
        }

        private static final int CENTER_X = 100;
        private static final int CENTER_Y = 100;
        private static final int CENTER_RADIUS = 32;

        private int floatToByte(float x) {
            int n = java.lang.Math.round(x);
            return n;
        }
        private int pinToByte(int n) {
            if (n < 0) {
                n = 0;
            } else if (n > 255) {
                n = 255;
            }
            return n;
        }

        private int ave(int s, int d, float p) {
            return s + java.lang.Math.round(p * (d - s));
        }

        private int interpColor(int colors[], float unit) {
            if (unit <= 0) {
                return colors[0];
            }
            if (unit >= 1) {
                return colors[colors.length - 1];
            }

            float p = unit * (colors.length - 1);
            int i = (int)p;
            p -= i;

            // now p is just the fractional part [0...1) and i is the index
            int c0 = colors[i];
            int c1 = colors[i+1];
            int a = ave(Color.alpha(c0), Color.alpha(c1), p);
            int r = ave(Color.red(c0), Color.red(c1), p);
            int g = ave(Color.green(c0), Color.green(c1), p);
            int b = ave(Color.blue(c0), Color.blue(c1), p);

            return Color.argb(a, r, g, b);
        }

        @SuppressWarnings("unused")
		private int rotateColor(int color, float rad) {
            float deg = rad * 180 / 3.1415927f;
            int r = Color.red(color);
            int g = Color.green(color);
            int b = Color.blue(color);

            ColorMatrix cm = new ColorMatrix();
            ColorMatrix tmp = new ColorMatrix();

            cm.setRGB2YUV();
            tmp.setRotate(0, deg);
            cm.postConcat(tmp);
            tmp.setYUV2RGB();
            cm.postConcat(tmp);

            final float[] a = cm.getArray();

            int ir = floatToByte(a[0] * r +  a[1] * g +  a[2] * b);
            int ig = floatToByte(a[5] * r +  a[6] * g +  a[7] * b);
            int ib = floatToByte(a[10] * r + a[11] * g + a[12] * b);

            return Color.argb(Color.alpha(color), pinToByte(ir),
                              pinToByte(ig), pinToByte(ib));
        }

        private static final float PI = 3.1415926f;

        @Override
        public boolean onTouchEvent(MotionEvent event) {
            float x = event.getX() - CENTER_X;
            float y = event.getY() - CENTER_Y;
            boolean inCenter = java.lang.Math.sqrt(x*x + y*y) <= CENTER_RADIUS;

            switch (event.getAction()) {
                case MotionEvent.ACTION_DOWN:
                    mTrackingCenter = inCenter;
                    if (inCenter) {
                        mHighlightCenter = true;
                        invalidate();
                        break;
                    }
                case MotionEvent.ACTION_MOVE:
                    if (mTrackingCenter) {
                        if (mHighlightCenter != inCenter) {
                            mHighlightCenter = inCenter;
                            invalidate();
                        }
                    } else {
                        float angle = (float)java.lang.Math.atan2(y, x);
                        // need to turn angle [-PI ... PI] into unit [0....1]
                        float unit = angle/(2*PI);
                        if (unit < 0) {
                            unit += 1;
                        }
                        mCenterPaint.setColor(interpColor(mColors, unit));
                        invalidate();
                    }
                    break;
                case MotionEvent.ACTION_UP:
                    if (mTrackingCenter) {
                        if (inCenter) {
                            mListener.colorChanged(mCenterPaint.getColor());
                        }
                        mTrackingCenter = false;    // so we draw w/o halo
                        invalidate();
                    }
                    break;
            }
            return true;
        }
    }

    public ColorPickerDialog(Context context,
                             OnColorChangedListener listener,
                             int initialColor) {
        super(context);

        mListener = listener;
        mInitialColor = initialColor;
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        OnColorChangedListener l = new OnColorChangedListener() {
            public void colorChanged(int color) {
                mListener.colorChanged(color);
                dismiss();
            }
        };

        setContentView(new ColorPickerView(getContext(), l, mInitialColor));
        setTitle("Pick a Color");
    }
}

main.java
package org.mazzarellialessio.studenttimetable;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import android.app.AlertDialog;
import android.app.Dialog;
import android.app.TabActivity;
import android.app.TimePickerDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.graphics.Color;
import android.os.Bundle;
import android.view.ContextMenu;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.view.Window;
import android.view.ContextMenu.ContextMenuInfo;
import android.widget.AdapterView;
import android.widget.AdapterView.AdapterContextMenuInfo;
import android.widget.AdapterView.OnItemSelectedListener;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ListView;
import android.widget.SimpleAdapter;
import android.widget.Spinner;
import android.widget.TabHost;
import android.widget.TextView;
import android.widget.TabHost.OnTabChangeListener;
import android.widget.TabHost.TabContentFactory;
import android.widget.TimePicker;

/** Workaround for use only one activity with more tab*/
public class main extends TabActivity implements OnTabChangeListener{
	
	private static final String MONDAY_TAB_TAG = "Monday";
	private static final String TUESDAY_TAB_TAG = "Tuesday";
	private static final String WEDNESDAY_TAB_TAG = "Wednesday";
	private static final String THURSDAY_TAB_TAG = "Thursday";
	private static final String FRIDAY_TAB_TAG = "Friday";
	private static TabHost tabHost;
	private static ListView mondayLW;
	private static ListView tuesdayLW;
	private static ListView wednesdayLW;
	private static ListView thursdayLW;
	private static ListView fridayLW;
	private static ListView currentLW;
	private static MyDBManager dm;
	private static ArrayList<HashMap<String, Object>> results;
	private static SimpleAdapter simpleAdapter;
	private static String[] from = {"SName","STeacher","HClass","HStart","HEnd"};
    private static int[] to = {R.id.SName,R.id.STeacher,R.id.HClass,R.id.HStart,R.id.HEnd};
    private static int currentDay;
    private static Intent intent;
    private static Dialog addDialog;
    private static EditText HClass;
    private static String[] arraydays;
    private static ArrayAdapter<String> Sarrayadapter;
    private static ArrayAdapter<String> arrayadapter;
    private static String selectedDay;
    private static TimePickerDialog fromDialog;
    private static TimePickerDialog toDialog;
    private static TextView start;
    private static TextView end;
    private static String[] arraySubjects;
    private static Spinner SName;
    private static Spinner HDay;
    private static String selectedSubject;
    private static String colorVet[];
    private static String action = "insert";
    private static String OLDSName;
    private static String OLDHClass;
    private static int OLDHDay;
    private static String OLDHStart;
    private static String OLDHEnd;
    private static AlertDialog.Builder builder;
    private static AlertDialog.Builder builder2;
    private static AlertDialog alert;
    private static AlertDialog alert2;
    private static Dialog aboutDialog;
    
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE); //remove app title
        setContentView(R.layout.main);
        
        
        dm = new MyDBManager(this); //Create DB
        
        //setup tab host
        tabHost = (TabHost) findViewById(android.R.id.tabhost);
        tabHost.setup();
        tabHost.setOnTabChangedListener(this);
        
        //setup lists
        mondayLW = (ListView) findViewById(R.id.monday);
        tuesdayLW = (ListView) findViewById(R.id.tuesday);
        wednesdayLW = (ListView) findViewById(R.id.wednesday);
        thursdayLW = (ListView) findViewById(R.id.thursday);
        fridayLW = (ListView) findViewById(R.id.friday);
        
        // add views to tab host
        tabHost.addTab(tabHost.newTabSpec(MONDAY_TAB_TAG)
        		.setIndicator(MONDAY_TAB_TAG)
        		.setContent(new TabContentFactory() {
        			public View createTabContent(String arg0) {
        				return mondayLW;
        			}
        }));
        tabHost.addTab(tabHost.newTabSpec(TUESDAY_TAB_TAG)
        		.setIndicator(TUESDAY_TAB_TAG)
        		.setContent(new TabContentFactory() {
        			public View createTabContent(String arg0) {
        				return tuesdayLW;
        			}
        }));
        tabHost.addTab(tabHost.newTabSpec(WEDNESDAY_TAB_TAG)
        		.setIndicator(WEDNESDAY_TAB_TAG)
        		.setContent(new TabContentFactory() {
        			public View createTabContent(String arg0) {
        				return wednesdayLW;
        			}
        }));
        tabHost.addTab(tabHost.newTabSpec(THURSDAY_TAB_TAG)
        		.setIndicator(THURSDAY_TAB_TAG)
        		.setContent(new TabContentFactory() {
        			public View createTabContent(String arg0) {
        				return thursdayLW;
        			}
        }));
        tabHost.addTab(tabHost.newTabSpec(FRIDAY_TAB_TAG)
        		.setIndicator(FRIDAY_TAB_TAG)
        		.setContent(new TabContentFactory() {
        			public View createTabContent(String arg0) {
        				return fridayLW;
        			}
        }));
        
        currentDay = getCurrentDayofWeek();
        tabHost.setCurrentTab(currentDay);
	    currentLW = mondayLW;
	    update();
	    
	    intent = new Intent(getApplicationContext(), AddSubjects.class);
	    
    	builder = new AlertDialog.Builder(this);
        builder.setMessage("Are you sure you want to delete all lessons?")
               .setCancelable(false)
               .setPositiveButton("Yes", new DialogInterface.OnClickListener() {
                   public void onClick(DialogInterface dialog, int id) {
                	   dm.deleteAllHours();
                       update();
                   }
               })
               .setNegativeButton("No", new DialogInterface.OnClickListener() {
                   public void onClick(DialogInterface dialog, int id) {
                        dialog.cancel();
                   }
               });
        alert = builder.create();
        
    	builder2 = new AlertDialog.Builder(this);
        builder2.setMessage("Are you sure you want to delete this lesson?")
               .setCancelable(false)
               .setPositiveButton("Yes", new DialogInterface.OnClickListener() {
                   public void onClick(DialogInterface dialog, int id) {
                	   dm.deleteHour(OLDSName, OLDHDay, OLDHClass, OLDHStart, OLDHEnd);
                       update();
                   }
               })
               .setNegativeButton("No", new DialogInterface.OnClickListener() {
                   public void onClick(DialogInterface dialog, int id) {
                        dialog.cancel();
                   }
               });
        alert2 = builder2.create();
        
        aboutDialog = new Dialog(this);
        aboutDialog.setContentView(R.layout.aboutdialog);
        aboutDialog.setTitle("About");
        aboutDialog.setCancelable(true);
        Button buttonDialog = (Button) aboutDialog.findViewById(R.id.Button01);
        buttonDialog.setOnClickListener(new OnClickListener() {
        	
        	public void onClick(View v) {
        			aboutDialog.cancel();
        	}
        });
    }
    
    public static int getCurrentDayofWeek() {
    	
    	Calendar c = Calendar.getInstance();
    	int currentDay = c.get(Calendar.DAY_OF_WEEK);
    	switch (currentDay) 
    	{
    	case 1:
    		/*Sunday*/
    		currentLW = mondayLW;
    		currentDay = 0;
    		break;
    	case 2:
    		/*Monday*/
    		currentLW = mondayLW;
    		currentDay -= 2;
    		break;
    	case 3:
    		/*Tuesday*/
    		currentLW = tuesdayLW;
    		currentDay -= 2;
    		break;
    	case 4:
    		/*Wednesday*/
    		currentLW = wednesdayLW;
    		currentDay -= 2;
    		break;
    	case 5:
    		/*Thursday*/
    		currentLW = thursdayLW;
    		currentDay -= 2;
    		break;
    	case 6:
    		/*Friday*/
    		currentLW = fridayLW;
    		currentDay -= 2;
    		break;
    	case 7:
    		/*Saturday*/
    		currentLW = mondayLW;
    		currentDay = 0;
    		break;
    	}
		return currentDay;
    }

	public void onTabChanged(String tabName) {
		/** Change the tab content to the appropriated one*/
		
    	if(tabName.equals(MONDAY_TAB_TAG)) {
    		currentLW = mondayLW;
    		currentDay = 0;
    	}
    	else if(tabName.equals(TUESDAY_TAB_TAG)) {
    		currentLW = tuesdayLW;
    		currentDay = 1;
    	}
    	else if(tabName.equals(WEDNESDAY_TAB_TAG)) {
    		currentLW = wednesdayLW;
    		currentDay = 2;
    	}
    	else if(tabName.equals(THURSDAY_TAB_TAG)) {
    		currentLW = thursdayLW;
    		currentDay = 3;
    	}
    	else if(tabName.equals(FRIDAY_TAB_TAG)) {
    		currentLW = fridayLW;
    		currentDay = 4;
    	}
    	update();
    	
        registerForContextMenu(mondayLW);
        registerForContextMenu(tuesdayLW);
        registerForContextMenu(wednesdayLW);
        registerForContextMenu(thursdayLW);
        registerForContextMenu(fridayLW);
    	
    	addDialog = new Dialog(this);
	    addDialog.setCancelable(false);
	    action = "insert";
	    addDialog.setTitle("Add Lesson");
	    addDialog.setContentView(R.layout.addhour);
	    
	    HClass = (EditText) addDialog.findViewById(R.id.classroomEdit);
	    arraydays = new String []{"Monday","Tuesday","Wednesday","Thursday","Friday"};
        HDay = (Spinner) addDialog.findViewById(R.id.day);
        arrayadapter = new ArrayAdapter<String>(this,
        		android.R.layout.simple_spinner_item, arraydays);
        arrayadapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        HDay.setAdapter(arrayadapter);
        HDay.setOnItemSelectedListener(new OnItemSelectedListener() {

            public void onItemSelected(AdapterView<?> arg0, View arg1, int position, long id) {                    
                 selectedDay = arraydays[position];               
            }

			public void onNothingSelected(AdapterView<?> arg0) {
				// TODO Auto-generated method stub
			}
        });
        
        fromDialog = new TimePickerDialog(this, fromTimeSetListener, 12, 0, true);
        toDialog = new TimePickerDialog(this, toTimeSetListener, 12, 0, true);
        
        SName = (Spinner) addDialog.findViewById(R.id.SName);
        SName.setOnItemSelectedListener(new OnItemSelectedListener() {

            public void onItemSelected(AdapterView<?> arg0, View arg1, int position, long id) {                    
                 selectedSubject = arraySubjects[position];               
            }

			public void onNothingSelected(AdapterView<?> arg0) {
				// TODO Auto-generated method stub
			}
        });
        
        Button buttonFrom = (Button) addDialog.findViewById(R.id.buttonFrom);
        buttonFrom.setOnClickListener(new View.OnClickListener() {			
			public void onClick(View v) {
				fromDialog.show();
			}
		});
        
        Button buttonTo = (Button) addDialog.findViewById(R.id.buttonTo);
        buttonTo.setOnClickListener(new View.OnClickListener() {			
			public void onClick(View v) {
				toDialog.show();
			}
		}); 
	    
        start = (TextView) addDialog.findViewById(R.id.start);
	    end = (TextView) addDialog.findViewById(R.id.end);
	    
	    Button cancel = (Button) addDialog.findViewById(R.id.cancel);
        cancel.setOnClickListener(new View.OnClickListener() {
                       
        	public void onClick(View v) {
        		addDialog.cancel();
        		fromDialog.updateTime(12, 0);
        		toDialog.updateTime(12, 0);
        		start.setText("--:--");
        		end.setText("--:--");
        		HClass.setText(null);
            }
        	
        });
        
        Button ok = (Button) addDialog.findViewById(R.id.ok);
        ok.setOnClickListener(new View.OnClickListener() {
                       
        	public void onClick(View v) {                              
        		int HDay = SDay2IDay(selectedDay);
        		if(action.equals("insert"))
        			dm.insertIntoHours(selectedSubject, HDay, HClass.getText().toString(), start.getText().toString(), end.getText().toString());
        		else if(action.equals("edit")) {
        			dm.updateHours(OLDSName, OLDHClass, OLDHDay, OLDHStart, OLDHEnd, selectedSubject, HDay, HClass.getText().toString(), start.getText().toString(), end.getText().toString());
        		}
        		addDialog.cancel();
        		fromDialog.updateTime(12, 0);
        		toDialog.updateTime(12, 0);
        		start.setText("--:--");
        		end.setText("--:--");
        		HClass.setText(null);
        		update();
            }
                        	
        });
        
	}
	
    private TimePickerDialog.OnTimeSetListener fromTimeSetListener =
    	new TimePickerDialog.OnTimeSetListener() {

			public void onTimeSet(TimePicker view, int hour,
					int minute) {
				
				StringBuilder sb = new StringBuilder();
				
				if(hour<10)
					sb.append("0");
				sb.append(hour+":");
				if(minute<10)
					sb.append("0");
				sb.append(minute);
				
				start.setText(sb);
			}

    };
    
    private TimePickerDialog.OnTimeSetListener toTimeSetListener =
    	new TimePickerDialog.OnTimeSetListener() {

			public void onTimeSet(TimePicker view, int hour,
					int minute) {
				
				StringBuilder sb = new StringBuilder();
				
				if(hour<10)
					sb.append("0");
				sb.append(hour+":");
				if(minute<10)
					sb.append("0");
				sb.append(minute);
				
				end.setText(sb);
			}
    };
    
    public boolean onCreateOptionsMenu(Menu menu) {
        boolean result = super.onCreateOptionsMenu(menu);
        menu.add(0, 0, 0, "Manage Subjects").setIcon(android.R.drawable.ic_menu_manage);
        menu.add(1, 1, 1, "Add Lesson").setIcon(android.R.drawable.ic_menu_add);
        menu.add(1, 2, 2, "Delete All").setIcon(android.R.drawable.ic_menu_delete);
        menu.add(2, 3, 3, "About").setIcon(android.R.drawable.ic_menu_info_details);
        return result;
    }
    
    public boolean onOptionsItemSelected(MenuItem item) {
        switch (item.getItemId()) {
            case 0:
            	startActivityForResult(intent, 0);
                break;
            case 1:
            	action = "insert";
            	ArrayList<HashMap<String, Object>> arrayS = dm.selectSubjects();
            	arraySubjects = new String [arrayS.size()];
                Iterator<HashMap<String, Object>> it = arrayS.iterator();
                int i = 0;
                while(it.hasNext()) {
                	HashMap<String, Object> hm = it.next();
                	arraySubjects[i] = hm.get("SName").toString();
                	i++;
                }
                Sarrayadapter = new ArrayAdapter<String>(this,
                		android.R.layout.simple_spinner_item, arraySubjects);
                Sarrayadapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
                SName.setAdapter(Sarrayadapter);
                addDialog.setTitle("Add Lesson");
            	addDialog.show();
            	break;
            case 2:
            	alert.show();
            	break;
            case 3:
            	aboutDialog.show();
        }
        return true;
    }
    
    private int SDay2IDay(String selectedDay) {
    	
    	if(selectedDay.equals("Tuesday"))
    		return 1;
    	else if(selectedDay.equals("Wednesday"))
    		return 2;
    	else if(selectedDay.equals("Thursday"))
    		return 3;
    	else if(selectedDay.equals("Friday"))
    		return 4;
    	
    	return 0;
    }
    
    private String IDay2SDay(int selectedDay) {
    	
    	if(selectedDay == 1)
    		return "Tuesday";
    	else if(selectedDay == 2)
    		return "Wednesday";
    	else if(selectedDay == 3)
    		return "Thursday";
    	else if(selectedDay == 4)
    		return "Friday";
    	
    	return "Monday";
    }
    
    private void update() {
    	
    	results = dm.selectAllFromDay(currentDay);
		colorVet = new String[results.size()];
	    for(int i=0;i<results.size();i++) {
	    	HashMap<String, Object> color = 
	    		new HashMap<String, Object>();
	    	color = results.get(i);
	    	colorVet[i] = (String) color.get("SColor");
	    }
	    simpleAdapter = new myAdapter(this, results, R.layout.daylist, from, to, colorVet);
	    currentLW.setAdapter(simpleAdapter); 
    }
    
	public class myAdapter extends SimpleAdapter{
        
		String[] colors;
        public myAdapter(Context context, List<? extends Map<String, ?>> data,
        	int resource, String[] from, int[] to, String[] col) {
            	super(context, data, resource, from, to);
                colors = col;
        	}
            public View getView(int position, View convertView, ViewGroup parent ) {
            	View view = super.getView(position, convertView, parent);
            	View label = view.findViewById(R.id.colorLabel);
                label.setBackgroundColor(Color.parseColor(colors[position]));
                return view;
            }
    }
	
    public void onCreateContextMenu(ContextMenu menu, View v, ContextMenuInfo menuInfo) {
    	super.onCreateContextMenu(menu, v, menuInfo);
    	menu.add(0, 1, 0, "Edit");
    	menu.add(0, 2, 0, "Delete");
    	menu.setHeaderTitle("Options");	
    }
    
    public boolean onContextItemSelected(MenuItem item) {
    	
    	AdapterContextMenuInfo info = (AdapterContextMenuInfo) item.getMenuInfo();
    	String course = results.get(info.position).get("SName").toString();
    	String classroom = results.get(info.position).get("HClass").toString();
    	String startH = results.get(info.position).get("HStart").toString();
    	String endH = results.get(info.position).get("HEnd").toString();
    	int day = currentDay;
    	
    	switch (item.getItemId()) {
        	case 1:
        		action = "edit";
            	ArrayList<HashMap<String, Object>> arrayS = dm.selectSubjects();
            	arraySubjects = new String [arrayS.size()];
                Iterator<HashMap<String, Object>> it = arrayS.iterator();
                int i = 0;
                while(it.hasNext()) {
                	HashMap<String, Object> hm = it.next();
                	arraySubjects[i] = hm.get("SName").toString();
                	i++;
                }
                Sarrayadapter = new ArrayAdapter<String>(this,
                		android.R.layout.simple_spinner_item, arraySubjects);
                Sarrayadapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
                SName.setAdapter(Sarrayadapter);
        		SName.setSelection(Sarrayadapter.getPosition(course));
        		String dayS = IDay2SDay(day);
        		HDay.setSelection(arrayadapter.getPosition(dayS));
            	CharSequence fhour = startH.subSequence(0, 2);
            	CharSequence fminutes = startH.subSequence(3, 5);
            	CharSequence thour = endH.subSequence(0, 2);
            	CharSequence tminutes = endH.subSequence(3, 5);
            	int fhourInt;
            	int fminutesInt;
            	try{
                	fhourInt = Integer.parseInt((String)fhour);
                	fminutesInt = Integer.parseInt((String)fminutes);
            	} catch(Exception e) {
            		fhourInt = 12;
                	fminutesInt = 0;
            	}
            	int thourInt;
            	int tminutesInt;
            	try{
                	thourInt = Integer.parseInt((String)thour);
                	tminutesInt = Integer.parseInt((String)tminutes);
            	} catch(Exception e) {
            		thourInt = 12;
                	tminutesInt = 0;
            	}
        		fromDialog.updateTime(fhourInt, fminutesInt);
        		toDialog.updateTime(thourInt, tminutesInt);
        		start.setText(startH);
        		end.setText(endH);
        		HClass.setText(classroom);
        		addDialog.setTitle("Edit Lesson");
        		OLDSName = course;
        		OLDHClass = classroom;
        		OLDHDay = day;
        		OLDHStart = startH;
        		OLDHEnd = endH;
        		addDialog.show();
        		break;
        	case 2:
        		OLDSName = course;
        		OLDHClass = classroom;
        		OLDHDay = day;
        		OLDHStart = startH;
        		OLDHEnd = endH;
        		alert2.show();
        		break;
    	}
    	update();
    	return true;
    }
    
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
		super.onActivityResult(requestCode, resultCode, data);
		
		update();
	}
    
}

//MyDBHelper.java
package org.mazzarellialessio.studenttimetable;

import android.content.Context;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;

public class MyDBHelper extends SQLiteOpenHelper {

	private static final String DBName = "studenttimetable.db";
	private static final int DBVersion = 1;
	
	public MyDBHelper(Context context) {
		super(context, DBName, null, DBVersion);
	}

	@Override
	public void onCreate(SQLiteDatabase db) {
		String query = "CREATE TABLE Subjects"
			+ "(SName TEXT PRIMARY KEY,"
			+ "STeacher TEXT,"
			+ "SColor TEXT"
			+ ");";
		db.execSQL(query);
		query = "CREATE TABLE Hours"
			+ "(_id INTEGER AUTO_INCREMENT PRIMARY KEY,"
			+ "SName TEXT,"
			+ "HDay INTEGER,"
			+ "HClass INTEGER,"
			+ "HStart TEXT,"
			+ "HEnd TEXT"
			+ ");";
		db.execSQL(query);
	}

	@Override
	public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
		db.execSQL("DROP TABLE IF EXISTS Hours");
		db.execSQL("DROP TABLE IF EXISTS Subjects");
		onCreate(db);
	}
}

//MyDBManager.java
package org.mazzarellialessio.studenttimetable;

import java.util.ArrayList;
import java.util.HashMap;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;

public class MyDBManager {
	
	public static MyDBHelper dbh;
	
	public MyDBManager(Context c) {
		dbh = new MyDBHelper(c);
	}
	
	public void insertIntoSubjects(String SName, String STeacher, String SColor) {
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			ContentValues values = new ContentValues();
			values.put("SName", SName);
			values.put("STeacher", STeacher);
			values.put("SColor", SColor);
			db.insert("Subjects", "", values);
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public void updateSubjects(String SName, String STeacher, String SColor) {
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			ContentValues values = new ContentValues();
			values.put("STeacher", STeacher);
			values.put("SColor", SColor);
			db.update("Subjects", values, "SName='"+SName+"'", null);
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public void deleteSubjects(String SName) {
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			db.delete("Subjects", "SName='"+SName+"'", null);
			db.delete("Hours", "SName='"+SName+"'", null);
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public void updateHours(String OLDSName, String OLDHClass, int OLDHDay, String OLDHStart, String OLDHEnd,
			String SName, int HDay, String HClass, String HStart, String HEnd) {
		
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			ContentValues values = new ContentValues();
			values.put("SName", SName);
			values.put("HDay", HDay);
			values.put("HClass", HClass);
			values.put("HStart", HStart);
			values.put("HEnd", HEnd);
			db.update("Hours", values, "SName='"+OLDSName+"'" +
					"AND HClass='"+OLDHClass+"'" +
					"AND HDay='"+OLDHDay+"'" +
					"AND HStart='"+OLDHStart+"'" +
					"AND HEnd='"+OLDHEnd+"'", null);
		} finally {
			if(db!= null)
				db.close();
		}
		
	}
	
	public ArrayList<HashMap<String, Object>> selectSubjects() {
		SQLiteDatabase db = dbh.getReadableDatabase();
		try {
			ArrayList<HashMap<String, Object>> results =
				new ArrayList<HashMap<String, Object>>();
			Cursor c = db.rawQuery("select * from Subjects",null);
			if (c.getCount() > 0) {
				c.moveToFirst();
				do {
					HashMap<String,Object> resultsMap =
						new HashMap<String, Object>();
					resultsMap.put("SName" , c.getString(c.getColumnIndex("SName")));
					resultsMap.put("STeacher" , c.getString(c.getColumnIndex("STeacher")));
					resultsMap.put("SColor" , c.getString(c.getColumnIndex("SColor")));
					results.add(resultsMap);
				} while(c.moveToNext());
			}
			c.close();
			return results;
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public void insertIntoHours(String SName, int HDay, String HClass, String HStart, String HEnd) {
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			ContentValues values = new ContentValues();
			values.put("SName", SName);
			values.put("HDay", HDay);
			values.put("HClass", HClass);
			values.put("HStart", HStart);
			values.put("HEnd", HEnd);
			db.insert("Hours", "", values);
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public void deleteHour(String SName, int HDay, String HClass, String HStart, String HEnd) {
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			db.delete("Hours",
					"SName = '"+SName+"' " +
					"AND HDay = '"+HDay+"' " +
					"AND HClass = '"+HClass+"' " +
					"AND HStart = '"+HStart+"' " +
					"AND HEnd = '"+HEnd+"' ", null);
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public void deleteAllHours() {
		SQLiteDatabase db = dbh.getWritableDatabase();
		try {
			db.delete("Hours", null, null);
		} finally {
			if(db!= null)
				db.close();
		}
	}
	
	public ArrayList<HashMap<String, Object>> selectAllFromDay(int HDay) {
		SQLiteDatabase db = dbh.getReadableDatabase();
		try {
			ArrayList<HashMap<String, Object>> results =
				new ArrayList<HashMap<String, Object>>();
			Cursor c = db.rawQuery("select * from Subjects, Hours where Subjects.SName=Hours.SName and HDay="+HDay+" order by HStart",null);			
			if (c.getCount() > 0) {
			c.moveToFirst();
				do {
					HashMap<String,Object> resultsMap =
						new HashMap<String, Object>();
					resultsMap.put("SName" , c.getString(c.getColumnIndex("SName")));
					resultsMap.put("STeacher" , c.getString(c.getColumnIndex("STeacher")));
					resultsMap.put("HClass" , c.getString(c.getColumnIndex("HClass")));
					resultsMap.put("HStart" , c.getString(c.getColumnIndex("HStart")));
					resultsMap.put("HEnd" , c.getString(c.getColumnIndex("HEnd")));
					resultsMap.put("SColor" , c.getString(c.getColumnIndex("SColor")));
					results.add(resultsMap);
				} while(c.moveToNext());
			}
			c.close();
			return results;
		} finally {
			if(db!= null)
				db.close();
		}
	}
}

//AndroidManifest.xml

This XML file does not appear to have any style information associated with it. The document tree is shown below.
<manifest xmlns:android="http://schemas.android.com/apk/res/android" package="org.mazzarellialessio.studenttimetable" android:versionCode="1" android:versionName="1.0">
<application android:icon="@drawable/icon" android:label="@string/app_name">
<activity android:name=".main" android:label="@string/app_name">
<intent-filter>
<action android:name="android.intent.action.MAIN"/>
<category android:name="android.intent.category.LAUNCHER"/>
</intent-filter>
</activity>
<activity android:name=".AddSubjects"></activity>
</application>
<uses-sdk android:minSdkVersion="4"/>
</manifest>


